<% include head.ejs %>
<% include nav.ejs %>


<div class="row-fluid">
<div id="networks" class="span7"></div>
<div id="profile" class="span3"></div>
<div id="error"></div>
</div>
<script>

// the network id passed from the ejs template
var userJID = '<%= userId %>';

function formatError(error){
	
}

function formatProfile(){
	var header = document.createElement('h3'),
		para1 = document.createElement('p'),
		para2 = document.createElement('p'),
		website = document.createElement('a'),
		proDiv = document.createElement('div');

	$(header).attr('id','name');
	$(para2).attr('id','descrip');
	$(website).attr('id','link').attr('target','_blank');

	$(para1).append(website);
	
	$(proDiv).addClass('profile')
		.append(header)
		.append(para1)
		.append(para2);

	return proDiv;
}
//NOTIFICATIONS SECTION, MAY NOT GO ON THIS PAGE
function formatNotifications(){
	var backDiv = document.createElement('div'),
		head = document.createElement('div'),
		content = document.createElement('div');
	
	$(head).html('Notifications');
	$(content).addClass('lightGray').html('this is a test');
	
	$(backDiv).addClass('notifications')
		.append(head)
		.append(content);
	
	return backDiv;
}

function formatImages(){
	var imageDiv = document.createElement('div');
	
	$(imageDiv).attr('id','image');
	
	return imageDiv;

}

function addElements(item, index){
	var header = document.getElementById('name'),
		link = document.getElementById('link'),
		descrip = document.getElementById('descrip'),
		imgDiv = document.getElementById('image'),
		image = document.createElement('img');

	if ((index == "firstName") || (index == "lastName")){
		$(header).append(item + ' ');
	}

	if (index == "website") {
		$(link).attr('href','http://www.triptychjs.com')
			.attr('target','_blank')
			.append('Check out my website');
	}

	if (index == "description") {
		$(descrip).append(item);
	}
	
	if (index =="backgroundImg") {
		var fImg = document.getElementById("foreground");
		$(image).attr('src',"../img/background/" + item);
		$(image).addClass('bckImg');
		$(imgDiv).append(image).append(fImg);
	}
	
	if (index =="foregroundImg") {
		$(image).attr('id','foreground')
			.attr('src',"../img/foreground/" + item);
		$(image).addClass('foreImg');
		$(imgDiv).append(image);
	}
}


function onWorkspace(jid){
	var tempLink = document.getElementById('link'+jid);
	var tempBtn = document.getElementById('button'+jid);
	var tempIcon = document.getElementById('icon'+jid);
	var found = false;
	
	
	$("input").each(function(index,value){
		if($(this).attr('title') == jid) {
			$(tempLink).attr('onclick','removeFromWorkspace(this)');
			$(tempBtn).attr('title','Remove from Workspace');
			tempIcon.className='icon-remove icon-white';
			found = true;
		}
	});
	
	if(found)return;
	
	$(tempLink).attr('onclick','addToWorkspace(this)');
	$(tempBtn).attr('title','Add to Workspace');
	tempIcon.className='icon-plus icon-white';
}

function removeFromWorkspace(obj){
	var parent = document.getElementById('workSurface');

	$("input").each(function(index,value){
		if($(this).attr('title') == $(obj).attr('title')){
			var child = document.getElementById('thumbnail' + $(this).attr('title'));
			parent.removeChild(child);
			onWorkspace($(obj).attr('title'));
		}
	});
	
}

function addToWorkspace(obj){
	var unlst = document.createElement('ul'),
		lst = document.createElement('li'),
		cnt = document.createElement('div'),
		formBox = document.createElement('form'),
		chckbox = document.createElement('input'),
		titleSpan = document.createElement('p');
	var parent = document.getElementById('workSurface');
		
	$(titleSpan).addClass('thumbText')
		.append($(obj).attr('title'));//
	$(chckbox).attr('id','checkbox' + $(obj).attr('title'))
		.attr('title',$(obj).attr('title'))
		.attr('type','checkbox');
	$(formBox).append(chckbox);
	$(cnt).addClass('thumbnail thumbIcon')
		.append(formBox)
		.append(titleSpan);
	$(lst).append(cnt);
	$(unlst).attr('id','thumbnail' + $(obj).attr('title'))
		.addClass('thumbnails')
		.append(lst);
	
	$(parent).append(unlst);
	onWorkspace($(obj).attr('title'));
}

function toggle(obj) {
	var divDisplay = obj.id +1;
	var ele = document.getElementById(divDisplay);
	var but = document.getElementById(obj.id +2);
	if(ele.style.display == "block") {
		ele.style.display = "none";
		but.className = 'icon-chevron-right';
	}
	else {
		ele.style.display = "block";
		but.className = 'icon-chevron-down';
	}
	
	onWorkspace($(obj).attr('title'));
}

function buttonTools(item){
	var buttonDiv = document.createElement('div'),
		wkSpaceLink=document.createElement('a'),
		viewLink=document.createElement('a'),
		visualizeLink=document.createElement('a'),
		wkSpaceBtn=document.createElement('button'),
		viewBtn=document.createElement('button'),
		visualizeBtn=document.createElement('button'),
		wkSpaceIcon=document.createElement('i'),
		viewIcon=document.createElement('i'),
		visualizeIcon=document.createElement('i');
		
	$(wkSpaceIcon).addClass('icon-plus icon-white').attr('id','icon'+item.jid);
	$(viewIcon).addClass('icon-folder-open icon-white');
	$(visualizeIcon).addClass('icon-eye-open icon-white');
	
	$(wkSpaceBtn).addClass('btn btn-primary')
		.attr('rel','tooltip')
		.attr('title','Add to Workspace')
		.attr('data-placement','bottom')
		.attr('id','button'+item.jid)
		.append(wkSpaceIcon);
	$(viewBtn).addClass('btn btn-primary')
		.attr('rel','tooltip')
		.attr('title','View Network')
		.attr('data-placement','bottom')
		.append(viewIcon);
	$(visualizeBtn).addClass('btn btn-primary')
		.attr('rel','tooltip')
		.attr('title','VisualizeNetwork')
		.attr('data-placement','bottom')
		.append(visualizeIcon);
	
	$(wkSpaceLink).attr('onclick','')
		.attr('id','link'+item.jid)
		.attr('title',item.jid)
		.append(wkSpaceBtn);
	$(viewLink).attr('href','../viewNetwork/' + item.jid)
		.append(viewBtn);
	$(visualizeLink).attr('href','../visualizeNetwork/' + item.jid)
		.append(visualizeBtn);
		
	$(buttonDiv).addClass('btn-group')
		.append(wkSpaceLink)
		.append(viewLink)
		.append(visualizeLink);
		
	return buttonDiv
}

function tableHead(){
    var mainDiv = document.createElement('div'),
        mainTable = document.createElement('table'),
        mainTblBody = document.createElement('tbody'),
        mainRow = document.createElement('tr'),
        mainCell = document.createElement('th');

    $(mainCell).addClass('span9').html("My Networks");

    $(mainRow).addClass('success').append(mainCell);
    $(mainTblBody).append(mainRow);
    $(mainTable).addClass('table').append(mainTblBody);
    $(mainDiv).append(mainTable);

    return mainDiv;

}

function formatNetworkDescriptor(item){
	var networkDIV = document.createElement('div'),
		nTable = document.createElement('table'),
        	tblBody = document.createElement('tbody'),
        	row = document.createElement('tr'),
		cell = document.createElement('td'),
		nodeSpan = document.createElement('span'),
		edgeSpan = document.createElement('span'),
		titleSpan = document.createElement('span'),
		iconSpan = document.createElement('span'),
		divButton = document.createElement('i'),
		networkLink = document.createElement('a'),
		buttonLink = document.createElement('a'),
		infoDiv = document.createElement('div');

	$(divButton).attr('rel','tooltip')
			.attr('title','More Info')
			.attr('id',item.title + 2)
			.addClass('icon-chevron-right');

	$(infoDiv).addClass('searchInfo').attr('id',item.title + 1)
					.attr('style','display: none')
					.append(buttonTools(item));	

	$(buttonLink).attr('id',item.title)
			.attr('title',item.jid)
			.attr('onClick', 'toggle(this)')
			.append(divButton);

	  
	$(networkLink).attr('href','viewNetwork/' + item.jid).append(item.title);
	$(nodeSpan).addClass('span2 elementCount').append(item.nodeCount + " nodes"); 
	$(edgeSpan).addClass('span2 elementCount').append(item.edgeCount + " edges"); 
	$(titleSpan).addClass('span4 networkTitle').append(networkLink); 
	$(iconSpan).addClass('span1').append(buttonLink);   
	

	$(cell).addClass('background-contrast').append(iconSpan)
		.append(titleSpan)
		.append(nodeSpan)
		.append(edgeSpan);
	
	$(row).append(cell);
	$(tblBody).append(row);
	$(nTable).addClass('table table-bordered table-hover').append(tblBody);

	$(networkDIV).addClass('networkDescriptor')
                 .append(nTable).append(infoDiv);

	return networkDIV;

}

$(ndexClient.getUser(userJID, function(data){
		console.log("Got results from getUser");
		console.log(data);
	
  		// Clears the nodes and edges divs
		$('#profile').html('');
		$('#networks').html('');
		
		$('#profile').append(formatProfile())
			.append(formatNotifications());
		$('#networks').append(formatImages()).append(tableHead());

  		$.each(data.user.profile, function(index, item){
			addElements(item, index);
			//$('#profile').append(index + image);
		});  
		
  		
  		$.each(data.user.ownedNetworks, function(index, network){
  			$('#networks').append(formatNetworkDescriptor(network));
  		});

    },
    // error handler
    function(error){
    	$('#error').append(formatError(error));
    })
);
</script>

<% include sidebar.ejs %>
<% include foot.ejs %>
